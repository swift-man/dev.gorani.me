---
import DefaultFooter from '@astrojs/starlight/components/Footer.astro';

const routeId = Astro.locals.starlightRoute?.id ?? '';
const isHomepage = routeId === '';

const repo = import.meta.env.PUBLIC_GISCUS_REPO;
const repoId = import.meta.env.PUBLIC_GISCUS_REPO_ID;
const category = import.meta.env.PUBLIC_GISCUS_CATEGORY ?? 'General';
const categoryId = import.meta.env.PUBLIC_GISCUS_CATEGORY_ID;
const mapping = import.meta.env.PUBLIC_GISCUS_MAPPING ?? 'pathname';
const reactionsEnabled = import.meta.env.PUBLIC_GISCUS_REACTIONS_ENABLED ?? '1';
const emitMetadata = import.meta.env.PUBLIC_GISCUS_EMIT_METADATA ?? '0';
const inputPosition = import.meta.env.PUBLIC_GISCUS_INPUT_POSITION ?? 'bottom';
const theme = import.meta.env.PUBLIC_GISCUS_THEME ?? 'preferred_color_scheme';
const lang = import.meta.env.PUBLIC_GISCUS_LANG ?? 'ko';

const giscusReady = Boolean(repo && repoId && categoryId);
---

<DefaultFooter {...Astro.props} />

{
  !isHomepage && giscusReady && (
    <section class="giscus-wrap" aria-label="Comments">
      <script
        is:inline
        src="https://giscus.app/client.js"
        data-repo={repo}
        data-repo-id={repoId}
        data-category={category}
        data-category-id={categoryId}
        data-mapping={mapping}
        data-strict="0"
        data-reactions-enabled={reactionsEnabled}
        data-emit-metadata={emitMetadata}
        data-input-position={inputPosition}
        data-theme={theme}
        data-lang={lang}
        crossorigin="anonymous"
        async
      ></script>
    </section>
  )
}

<style>
  .giscus-wrap {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--sl-color-hairline-light);
  }
</style>
